(()=>{"use strict";var e={3:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ImageCollider=void 0;const i=n(617),s=n(284);t.ImageCollider=class{constructor(e){this.size=new i.Vec2(e.width,e.height),this.bitArray=new s.BitArray(this.size.x*this.size.y);let t=0,n=0;for(let i=0;i<e.height;i++)for(let i=0;i<e.width;i++)this.bitArray.set(t,e.data[n+3]>0),t++,n+=4}hitTestPoint(e,t){return e=Math.floor(e),t=Math.floor(t),e<0||e>=this.size.x||t<0||t>=this.size.y||this.bitArray.get(t*this.size.x+e)}hitTestImage(e,t,n){const i=e%1>0,s=t%1>0;e=Math.floor(e),t=Math.floor(t);const a=(e,t)=>e<0||e>r.x||t<0||t>r.y||this.bitArray.get(t*r.x+e),o=n.size,r=this.size;for(let c=0;c<o.y;c++){const l=t+c;if(l<0||l>=r.y)return!0;for(let t=0;t<o.x;t++)if(n.bitArray.get(c*o.x+t)){const n=e+t;if(n<0||n>=r.y)return!0;if(this.bitArray.get(l*r.x+n))return!0;if(i&&a(n+1,l))return!0;if(s&&a(n,l+1))return!0;if(i&&s&&a(n+1,l+1))return!0}}return!1}}},52:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Scene=void 0;const i=n(658);class s extends i.Component{constructor(e){super(),this.element=$('<div class="scene">').addClass(e)}onStartScene(){}onEndScene(){}}t.Scene=s},75:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MainEngineSound=void 0;const i=n(771);t.MainEngineSound=class{constructor(e,t,n){this.audioContext=e,this.whiteNoiseAudioBuffer=t,this.gain=n,this.gainNode=e.createGain(),this.gainNode.connect(e.destination)}play(){null==this.audioBufferSourceNode&&(this.audioBufferSourceNode=this.audioContext.createBufferSource(),this.audioBufferSourceNode.buffer=this.whiteNoiseAudioBuffer,this.audioBufferSourceNode.loop=!0,this.audioBufferSourceNode.playbackRate.value=.08,this.audioBufferSourceNode.connect(this.gainNode),this.gainNode.gain.value=0,this.gainNode.gain.linearRampToValueAtTime(this.gain,this.audioContext.currentTime+i.shortGainFade),this.audioBufferSourceNode.start())}stop(){if(null==this.audioBufferSourceNode)return;const e=this.audioBufferSourceNode;this.audioBufferSourceNode=void 0,this.gainNode.gain.value=this.gain,this.gainNode.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+i.shortGainFade),e.stop(this.audioContext.currentTime+i.shortGainFade),e.onended=()=>e.disconnect()}}},156:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=n(680),a=n(742),o=n(288),r=n(392),c=n(283);$((()=>i(void 0,void 0,void 0,(function*(){return(new l).start()}))));class l{start(){return i(this,void 0,void 0,(function*(){a.gameState.isResetData&&(s.faceMoonChallengeLocalStorage.clearStageIndex=-1,history.replaceState(null,"","/")),$(document.body).append(o.sceneController.element),o.sceneController.changeScene(a.gameState.isSoundTest?new r.SoundTestScene:new c.TermsScene),window.addEventListener("keydown",(e=>{e.target instanceof HTMLButtonElement&&("Enter"==e.key||" "==e.key)&&e.preventDefault()}),!0)}))}}},240:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RgbRange=void 0,t.RgbRange=class{constructor(e,t){this.col1=e,this.col2=t}fade(e){const t=(t,n)=>{return i=t*(1-e)+n*e,Math.floor(i).toString(16).padStart(2,"0");var i};return`#${t(this.col1.r,this.col2.r)}${t(this.col1.g,this.col2.g)}${t(this.col1.b,this.col2.b)}`}rnd(){return this.fade(Math.random())}}},271:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.soundManager=void 0;const i=n(795),s=n(321),a=n(75),o=n(771);t.soundManager=new class{constructor(){this.audioContext=new AudioContext({latencyHint:"interactive"}),document.addEventListener("pointerdown",(()=>this.audioContext.resume()),!0),this.whiteNoiseAudioBuffer=this.generateWhiteNoise(2),this.leftGusSound=new s.GusSound(this.audioContext,this.whiteNoiseAudioBuffer,-1,.3),this.rightGusSound=new s.GusSound(this.audioContext,this.whiteNoiseAudioBuffer,1,.3),this.mainEngineSound=new a.MainEngineSound(this.audioContext,this.whiteNoiseAudioBuffer,.3)}generateWhiteNoise(e,t=44100){const n=this.audioContext.createBuffer(1,t*e,t),i=n.getChannelData(0);for(let e=0;e<i.length;e++)i[e]=2*Math.random()-1;return n}playExplosion(){for(let e=0;e<5;e++)this.playExplosionImp((0,i.rndRange)(0,.1),(0,i.rndRange)(1,1.6),(0,i.rndRange)(.01,.03),.6)}playExplosionImp(e,t=1.5,n=.01,i=.5){const s=this.audioContext.currentTime+e,a=this.audioContext.createBufferSource();a.buffer=this.whiteNoiseAudioBuffer,a.playbackRate.value=n,a.loop=!0;const r=this.audioContext.createGain();r.gain.setValueAtTime(0,s),r.gain.linearRampToValueAtTime(i,s+o.shortGainFade),r.gain.exponentialRampToValueAtTime(.01,s+t),a.connect(r).connect(this.audioContext.destination),a.start(s),a.stop(s+t),a.onended=()=>{a.disconnect(),r.disconnect()}}playButtonTap(){const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.type="sine",e.frequency.setValueAtTime(1300,this.audioContext.currentTime),t.gain.setValueAtTime(.3,this.audioContext.currentTime),t.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.1),e.connect(t).connect(this.audioContext.destination),e.start(),e.stop(this.audioContext.currentTime+.1),e.onended=()=>{e.disconnect(),t.disconnect()}}stopSpaceshipSounds(){this.leftGusSound.stop(),this.rightGusSound.stop(),this.mainEngineSound.stop()}}},277:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FixedSimulationAnimator=void 0;const i=n(926);t.FixedSimulationAnimator=class{constructor(e){this.simulationFps=e,this.frameRequester=new i.AnimationFrameRequester,this._fps=0}get fps(){return this._fps}start(e,t){const n=1e3/this.simulationFps;let i,s,a=0,o=0,r=0;const c=l=>{if(null!=i){a+=Math.min(l-i,1e3/15);let c=!1;for(;a>=n;)a-=n,e(),c=!0;t(null==s?0:(l-s)/1e3),s=l,l>o+1e3?(o=l,this._fps=r,r=0):r++}i=l,this.frameRequester.request(c)};this.frameRequester.request(c)}stop(){this.frameRequester.cancel()}}},283:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TermsScene=void 0;const i=n(393),s=n(343),a=n(52),o=n(288),r=["本ゲームは iPhone 15 Plus でのみ動作検証を行っています。それ以前の端末では正常に動作しない可能性があります。","このゲームはカメラを使用します。次の画面でカメラの使用を許可してください。カメラの映像はゲーム以外の目的では使用しません。","カメラの動作が止まったり遅くなったりした場合はページをリロードしてください。","顔の動きを利用するゲームですが、身体に痛みなどの異常を感じた場合は、ただちにゲームを中止し、医師の指示に従ってください。","効果音が鳴ります。音量にご注意ください。","ゲーム配信や紹介動画の作成は大歓迎です。許可は不要です。","本ゲームに関連して発生したいかなるトラブルについて、開発者は一切の責任を負いません。"];class c extends a.Scene{constructor(){super("term-scene"),this.element.append($('<div class="title">').text("利用規約"),$("<ul>").append(r.map((e=>$("<li>").text(e)))),new i.Button("同意して進む",(()=>o.sceneController.changeScene(new s.LoadingScene))).element)}}t.TermsScene=c},284:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BitArray=void 0,t.BitArray=class{constructor(e){this.size=e,this.array=new Uint32Array(Math.ceil(e/32))}set(e,t){const n=Math.floor(e/32),i=e%32;t?this.array[n]|=1<<i:this.array[n]&=~(1<<i)}get(e){const t=Math.floor(e/32),n=e%32;return!!(this.array[t]&1<<n)}}},285:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GameOverMenu=void 0;const i=n(393),s=n(658),a=n(742),o=n(288),r=n(984),c=n(493),l=["爆発しちゃったけど無人だから安心して！","もう一回チャレンジしてみよう！","アゴは大丈夫そう？無理はしないでね！","次はきっとうまくいくよ！"];class h extends s.Component{constructor(){super(),this.element=$('<div class="game-over-menu">').append($('<div class="stage">').text(`ステージ${a.gameState.stageInfo.title}`),$('<div class="title">').text("着陸失敗"),$('<div class="message">').text(l[Math.floor(l.length*Math.random())]),new i.Button("再チャレンジ",(()=>o.sceneController.changeScene(new c.GameScene))).element,new i.Button("ステージセレクト",(()=>o.sceneController.changeScene(new r.StageSelectScene))).element)}}t.GameOverMenu=h},286:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EnergyBar=void 0;const i=n(658),s=n(565),a=new(n(240).RgbRange)(new s.Rgb(255,0,0),new s.Rgb(0,255,0));class o extends i.Component{constructor(){super(),this.rectEl=$('<div class="rect">'),this.lastRatio=-1,this.element=$('<div class="energy-bar">').append(this.rectEl)}set ratio(e){this.lastRatio!=e&&(this.lastRatio,this.rectEl.css({background:a.fade(e),width:100*e+"%"}))}}t.EnergyBar=o,o.height=20},287:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Rect=void 0;const i=n(617);class s{constructor(e,t,n,i){this.x=e,this.y=t,this.width=n,this.height=i}get left(){return this.x}get top(){return this.y}get right(){return this.x+this.width}get bottom(){return this.y+this.height}get center(){return new i.Vec2((this.left+this.right)/2,(this.top+this.bottom)/2)}get size(){return new i.Vec2(this.width,this.height)}get isEmpty(){return this.width<=0||this.height<=0}offset(e){return new s(this.x+e.x,this.y+e.y,this.width,this.height)}scale(e){return new s(this.x*e,this.y*e,this.width*e,this.height*e)}deflate(e){var t,n,i,a,o;const r=null!==(t=e.all)&&void 0!==t?t:0;return s.fromLeftTopRightBottom(this.left+(null!==(n=e.left)&&void 0!==n?n:r),this.top+(null!==(i=e.top)&&void 0!==i?i:r),this.right-(null!==(a=e.right)&&void 0!==a?a:r),this.bottom-(null!==(o=e.bottom)&&void 0!==o?o:r))}objectPosition(e){return new s((this.width-e.x)/2,(this.top+this.bottom-e.y)/2,e.x,e.y)}objectFitContain(e){if(this.isEmpty)return s.zero;const t=Math.min(this.width/e.x,this.height/e.y),n=e.scale(t);return this.objectPosition(n)}intersect(e){const t=Math.max(this.left,e.left),n=Math.max(this.top,e.top),i=Math.min(this.right,e.right),a=Math.min(this.bottom,e.bottom),o=Math.max(0,i-t),r=Math.max(0,a-n);return new s(t,n,o,r)}union(e){if(this.isEmpty)return e;if(e.isEmpty)return this;const t=Math.min(this.left,e.left),n=Math.min(this.top,e.top),i=Math.max(this.right,e.right),a=Math.max(this.bottom,e.bottom);return new s(t,n,i-t,a-n)}toString(){return`{ x: ${this.x}, y: ${this.y}, width: ${this.width}, height: ${this.height}}`}static fromSize(e){return new s(0,0,e.x,e.y)}static fromLeftTopRightBottom(e,t,n,i){return new s(e,t,n-e,i-t)}static fromOuterBounds(e){var t,n;return new s(0,0,null!==(t=e.outerWidth())&&void 0!==t?t:0,null!==(n=e.outerHeight())&&void 0!==n?n:0)}}t.Rect=s,s.zero=new s(0,0,0,0)},288:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.sceneController=void 0;const s=n(658),a=n(890),o=n(363),r=n(287),c=n(617),l=n(463);class h extends s.Component{constructor(){super(),this.faceStateTracker=new o.FaceStateTracker,this.screen1=new a.VirtualScreen(new c.Vec2(375,630)),this.element=$('<div class="scene-ctrl">').append(this.faceStateTracker.element,this.screen1.element),new ResizeObserver((()=>this.layout())).observe(this.element[0])}get screenSize(){return this.screen1.size}layout(){var e;const t=r.Rect.fromOuterBounds(this.element).objectFitContain(this.screen1.size);this.screen1.layout(t),null===(e=this.screen2)||void 0===e||e.layout(t)}changeScene(e){return i(this,void 0,void 0,(function*(){var t;null===(t=this._curScene)||void 0===t||t.onEndScene(),this.closeOverlayMenu(),this.screen1.element.empty().append(e.element),this._curScene=e,e.onStartScene()}))}error(e){this.changeScene(new l.ErrorScene(e))}showOverlayMenu(e){null==this.screen2&&(this.screen2=new a.VirtualScreen(this.screen1.size),this.element.append($('<div class="darkness">'),this.screen2.element.append(e)),this.layout())}closeOverlayMenu(){var e;this.element.find(".darkness").remove(),null===(e=this.screen2)||void 0===e||e.element.remove(),this.screen2=void 0}}t.sceneController=new h},321:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GusSound=void 0;const i=n(771);t.GusSound=class{constructor(e,t,n,i){this.audioContext=e,this.whiteNoiseAudioBuffer=t,this.gain=i,this.bandFilterNode=e.createBiquadFilter(),this.bandFilterNode.type="bandpass",this.bandFilterNode.frequency.value=1e4,this.bandFilterNode.Q.value=1,this.gainNode=e.createGain();const s=e.createStereoPanner();s.pan.value=n,this.bandFilterNode.connect(this.gainNode).connect(s).connect(e.destination)}play(){null==this.audioBufferSourceNode&&(this.audioBufferSourceNode=this.audioContext.createBufferSource(),this.audioBufferSourceNode.buffer=this.whiteNoiseAudioBuffer,this.audioBufferSourceNode.loop=!0,this.audioBufferSourceNode.connect(this.bandFilterNode),this.gainNode.gain.value=0,this.gainNode.gain.linearRampToValueAtTime(this.gain,this.audioContext.currentTime+i.shortGainFade),this.audioBufferSourceNode.start())}stop(){if(null==this.audioBufferSourceNode)return;const e=this.audioBufferSourceNode;this.audioBufferSourceNode=void 0,this.gainNode.gain.value=this.gain,this.gainNode.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+i.shortGainFade),e.stop(this.audioContext.currentTime+i.shortGainFade),e.onended=()=>e.disconnect()}}},343:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.LoadingScene=void 0;const s=n(611),a=n(917),o=n(52),r=n(288),c=n(487);class l extends o.Scene{constructor(){super("loading-scene"),this.element.text("ロード中...")}onStartScene(){return i(this,void 0,void 0,(function*(){try{yield Promise.all([s.faceApi.readWeights(),a.spriteSheet.load()]),r.sceneController.changeScene(new c.TitleScene)}catch(e){r.sceneController.error(`エラーが発生しました(${e})。`)}}))}}t.LoadingScene=l},363:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.FaceStateTracker=void 0;const s=n(593),a=n(658),o=n(680),r=n(288),c=n(892),l=n(525);class h extends a.Component{constructor(){super(),this.videoEl=$('<video class="video" muted playsinline>'),this._timeout=new s.TimeoutTimer,this._isStarted=!1,this._detecting=!1,this.element=this.videoEl,this.videoDisplayStyle=o.faceMoonChallengeLocalStorage.videoDisplayStyle}get video(){return this.videoEl[0]}get lastFaceState(){return this._lastFaceState}set videoDisplayStyle(e){this.videoEl.removeClass(l.videoDisplayStyleInfos.map((e=>e.style))),this.videoEl.addClass(e)}startVideoStream(){return i(this,void 0,void 0,(function*(){const e=yield navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:!1});for(;this._detecting;)yield new Promise((e=>setTimeout(e,0)));this.video.pause(),this.video.srcObject=null,this.video.srcObject=e,this.video.play()}))}startTrack(){return i(this,void 0,void 0,(function*(){try{return yield this.startVideoStream(),this._isStarted||(this.startTrackImpl(),this._isStarted=!0),!0}catch(e){return r.sceneController.error(`カメラの初期化に失敗しました。\n${e}`),!1}}))}startTrackImpl(){return i(this,void 0,void 0,(function*(){for(;;)this._detecting=!0,this._lastFaceState=yield c.faceStateChecker.getFaceState(this.video),this._detecting=!1,yield this._timeout.start(0)}))}}t.FaceStateTracker=h},392:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SoundTestScene=void 0;const i=n(271),s=n(52);class a extends s.Scene{constructor(){super("sound-test-scene"),this.element.append($('<button class="button">').text("左ガス Play").on("click",(()=>i.soundManager.leftGusSound.play())),$('<button class="button">').text("左ガス Stop").on("click",(()=>i.soundManager.leftGusSound.stop())),$('<button class="button">').text("右ガス Play").on("click",(()=>i.soundManager.rightGusSound.play())),$('<button class="button">').text("右ガス Stop").on("click",(()=>i.soundManager.rightGusSound.stop())),$('<button class="button">').text("エンジン Play").on("click",(()=>i.soundManager.mainEngineSound.play())),$('<button class="button">').text("エンジン Stop").on("click",(()=>i.soundManager.mainEngineSound.stop())),$('<button class="button">').text("爆発").on("click",(()=>i.soundManager.playExplosion())),$('<button class="button">').text("ボタンタップ音").on("click",(()=>i.soundManager.playButtonTap())))}}t.SoundTestScene=a},393:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Button=void 0;const i=n(271),s=n(658);class a extends s.Component{constructor(e,t,n=[]){super(),this.element=$('<button class="button">').text(e).on("click",(()=>{i.soundManager.playButtonTap(),t()})).addClass(n)}}t.Button=a},463:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorScene=void 0;const i=n(52);class s extends i.Scene{constructor(e){super("error-scene"),this.element.text(e)}}t.ErrorScene=s},487:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.TitleScene=void 0;const s=n(277),a=n(393),o=n(917),r=n(679),c=n(617),l=n(271),h=n(521),u=n(622),d=n(507),g=n(52),p=n(288),f=n(984),m=n(592);class v extends g.Scene{constructor(){super("title-scene"),this.gameCanvas=new h.GameCanvas(new c.Vec2(p.sceneController.screenSize.x,200),!0),this.fixedSimAnimator=new s.FixedSimulationAnimator(60),this.spaceship=new d.Spaceship(new r.MutableVec2(32,27),50),this.particleMan=new u.ParticleManager,this.count=0,this.element.append($('<div class="title"><span class="face">顔</span><span class="de">で</span><span class="moon">月面着陸</span><br><span class="challenge">チャレンジ</span></div>'),this.gameCanvas.element,$('<div class="video-style-selector-container">').append($("<div>").text("ビデオ表示："),(new m.VideoDisplayStyleSelector).element),new a.Button("スタート",(()=>p.sceneController.changeScene(new f.StageSelectScene))).element,$('<div class="copyright">Copyright (C) 2025 <a href="https://takabosoft.com/" target="_blank">Takabo Soft</a></div>'),$('<div class="sub-menu">').append($('<a href="license.txt" target="_blank">知的財産の表記</a>')))}onStartScene(){return i(this,void 0,void 0,(function*(){(yield p.sceneController.faceStateTracker.startTrack())&&(this.gameCanvas.setupTransform(o.spriteInfos.instruction1.size),this.fixedSimAnimator.start((()=>this.onSimulation()),(e=>this.onRender(e))))}))}onEndScene(){this.fixedSimAnimator.stop(),l.soundManager.stopSpaceshipSounds()}onSimulation(){this.particleMan.onSimulation(),this.spaceship.onSimulation(void 0,this.particleMan,void 0),this.count++}onRender(e){this.gameCanvas.clear(),this.particleMan.draw(this.gameCanvas.ctx),o.spriteSheet.drawSprite(this.gameCanvas.ctx,0,0,Math.floor(this.count/40)%2?o.spriteInfos.instruction1:o.spriteInfos.instruction2),this.spaceship.draw(this.gameCanvas.ctx)}}t.TitleScene=v},493:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.GameScene=void 0;const s=n(277),a=n(742),o=n(679),r=n(52),c=n(288),l=n(286),h=n(521),u=n(970),d=n(603),g=n(285),p=n(622),f=n(507),m=n(758),v=n(680);class y extends r.Scene{constructor(){super("game-scene"),this.readyText=$('<div class="ready-text">').text("3"),this.gameCanvas=new h.GameCanvas(c.sceneController.screenSize),this.energyBar=new l.EnergyBar,this.fixedSimAnimator=new s.FixedSimulationAnimator(60),this.particleMan=new p.ParticleManager,this.state=0,this.readyCount=0,this.element.append(this.gameCanvas.element,$('<div class="energy-container">').append($('<div class="energy-label">').text("ENERGY:"),this.energyBar.element),this.readyText);const e=a.gameState.stageInfo;this.terrain=new m.Terrain(e.terrainRect),this.landingZone=new u.LandingZone(e.landingZone),this.spaceship=new f.Spaceship(new o.MutableVec2(e.starshipPos.x,e.starshipPos.y),e.energy)}onStartScene(){return i(this,void 0,void 0,(function*(){this.gameCanvas.setupTransform(this.terrain.spriteRect.size,{bottom:l.EnergyBar.height}),this.fixedSimAnimator.start((()=>this.onSimulation()),(e=>this.onRender(e)))}))}onEndScene(){this.fixedSimAnimator.stop()}onSimulation(){switch(this.particleMan.onSimulation(),this.landingZone.onSimulation(),this.spaceship.onSimulation(this.terrain,this.particleMan,this.landingZone),this.state){case 0:case 1:case 2:case 3:if(this.readyCount++,this.readyCount>25)switch(this.readyCount=0,this.state++,this.state){case 1:this.readyText.text("2");break;case 2:this.readyText.text("1");break;case 3:this.readyText.text("GO!");break;case 4:this.readyText.remove(),this.spaceship.play()}break;case 4:this.spaceship.isExploded?(this.state=5,c.sceneController.showOverlayMenu((new g.GameOverMenu).element)):this.spaceship.isLanded&&(this.state=6,v.faceMoonChallengeLocalStorage.clearStageIndex=Math.max(v.faceMoonChallengeLocalStorage.clearStageIndex,a.gameState.stageIndex),c.sceneController.showOverlayMenu((new d.GameClearMenu).element))}}onRender(e){this.gameCanvas.clear(),this.particleMan.draw(this.gameCanvas.ctx),this.landingZone.draw(this.gameCanvas.ctx),this.terrain.draw(this.gameCanvas.ctx),this.spaceship.draw(this.gameCanvas.ctx),this.energyBar.ratio=this.spaceship.energyRatio}}t.GameScene=y},507:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Spaceship=void 0;const i=n(679),s=n(287),a=n(617),o=n(917),r=n(3),c=n(565),l=n(240),h=n(288),u=n(568),d=n(622),g=n(271),p=.002,f=new s.Rect(5,15,6,1),m={rgbRange:new l.RgbRange(new c.Rgb(188,0,0),new c.Rgb(255,255,160)),dir:new a.Vec2(0,1),speedRange:new d.ValueRange(.5,3),lifeRange:new d.ValueRange(6,9)},v=new s.Rect(4,4,1,1),y={rgbRange:new l.RgbRange(new c.Rgb(0,244,244),new c.Rgb(255,255,255)),dir:new a.Vec2(-1,0),speedRange:new d.ValueRange(.5,2),lifeRange:new d.ValueRange(4,7)},S=new s.Rect(12,4,1,1),w=Object.assign(Object.assign({},y),{dir:new a.Vec2(1,0)}),x=new s.Rect(6,17,7,1);t.Spaceship=class{constructor(e,t){this.topLeft=e,this.maxEnergy=t,this.inertia=new i.MutableVec2(0,0),this.state=0,this.landingCount=0,this.imageCollider=new r.ImageCollider(o.spriteSheet.getImageData(o.spriteInfos.spaceship)),this.remainEnergy=t}get energyRatio(){return Math.max(this.remainEnergy/this.maxEnergy,0)}get isExploded(){return 3==this.state&&null!=this.explosion&&this.explosion.counter>40}get isLanded(){return 2==this.state&&this.landingCount>40}get isMainEngineOn(){var e,t;return null!==(t=null===(e=h.sceneController.faceStateTracker.lastFaceState)||void 0===e?void 0:e.isMouthOpen)&&void 0!==t&&t}get isLeftGusOn(){var e;const t=null===(e=h.sceneController.faceStateTracker.lastFaceState)||void 0===e?void 0:e.yaw;return null!=t&&t<-6}get isRightGusOn(){var e;const t=null===(e=h.sceneController.faceStateTracker.lastFaceState)||void 0===e?void 0:e.yaw;return null!=t&&t>6}play(){0==this.state&&(this.state=1)}onSimulation(e,t,n){var i;if(3==this.state)return void(null===(i=this.explosion)||void 0===i||i.onSimulation());if(2==this.state)return void this.landingCount++;const s=0==this.state,r=1==this.state;r&&(this.inertia.y+=.01);let c=!1,l=!1,h=!1;if((r||s)&&(this.isMainEngineOn&&this.remainEnergy>0&&(r&&(this.inertia.y-=.03,this.remainEnergy-=.03),t.generate(15,f.offset(this.topLeft),m),c=!0),this.isLeftGusOn&&this.remainEnergy>0?(r&&(this.inertia.x+=p,this.remainEnergy-=p),t.generate(5,v.offset(this.topLeft),y),l=!0):this.isRightGusOn&&this.remainEnergy>0&&(r&&(this.inertia.x-=p,this.remainEnergy-=p),t.generate(5,S.offset(this.topLeft),w),h=!0)),c?g.soundManager.mainEngineSound.play():g.soundManager.mainEngineSound.stop(),l?g.soundManager.leftGusSound.play():g.soundManager.leftGusSound.stop(),h?g.soundManager.rightGusSound.play():g.soundManager.rightGusSound.stop(),null==e||null==n)return;const d=this.topLeft.x+this.inertia.x,M=this.topLeft.y+this.inertia.y;return e.imageCollider.hitTestImage(d,M,this.imageCollider)?!x.offset(this.topLeft).union(x.offset(new a.Vec2(d,M))).intersect(n.rect).isEmpty&&this.inertia.y<=.5?(this.topLeft.y=n.rect.y-x.y+1,this.state=2,void g.soundManager.stopSpaceshipSounds()):(this.state=3,this.explosion=new u.Explosion(new a.Vec2(this.topLeft.x+o.spriteInfos.spaceship.width/2,this.topLeft.y+o.spriteInfos.spaceship.height/2)),g.soundManager.stopSpaceshipSounds(),void g.soundManager.playExplosion()):(this.topLeft.x=d,void(this.topLeft.y=M))}draw(e){var t;let n=1;null!=this.explosion&&(n=1-Math.min(this.explosion.counter/50,1)),o.spriteSheet.drawSprite(e,this.topLeft.x,this.topLeft.y,o.spriteInfos.spaceship,n),null===(t=this.explosion)||void 0===t||t.draw(e)}}},521:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GameCanvas=void 0;const i=n(658),s=n(287);class a extends i.Component{constructor(e,t=!1){super(),this.element=$('<canvas class="game-canvas">'),this.canvas=this.element[0],this.canvas.width=2*e.x,this.canvas.height=2*e.y,this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,t&&this.element.css({position:"relative",width:e.x,height:e.y})}setupTransform(e,t={}){var n;this.ctx.resetTransform();const i=new s.Rect(0,0,this.canvas.width,this.canvas.height).deflate({bottom:2*(null!==(n=t.bottom)&&void 0!==n?n:0)}).objectFitContain(e);this.ctx.translate(i.x,i.y),this.ctx.scale(i.width/e.x,i.height/e.y)}clear(){const e=this.ctx.getTransform();this.ctx.resetTransform(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.setTransform(e)}}t.GameCanvas=a},525:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.videoDisplayStyleInfos=void 0,t.videoDisplayStyleInfos=[{style:"off",name:"オフ"},{style:"dark",name:"暗くする"},{style:"normal",name:"未加工"}]},565:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Rgb=void 0,t.Rgb=class{constructor(e,t,n){this.r=e,this.g=t,this.b=n}}},568:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Explosion=void 0;const i=n(617),s=n(917),a=n(795);t.Explosion=class{constructor(e){this._counter=0,this.particles=[];for(let t=0;t<250;t++){const t=(0,a.rndRange)(0,40),n=t+(0,a.rndRange)(20,40),s=Math.random()*Math.PI*2,r=10*Math.random(),c=r+(0,a.rndRange)(10,20),l=new i.Vec2(e.x+Math.cos(s)*r,e.y+Math.sin(s)*r),h=new i.Vec2(e.x+Math.cos(s)*c,e.y+Math.sin(s)*c),u=(0,a.rndRange)(0,2*Math.PI);this.particles.push(new o(t,n,l,h,u,u+(0,a.rndRange)(1*-Math.PI,1*Math.PI),(0,a.rndRange)(.2,1.5)))}}get counter(){return this._counter}onSimulation(){this._counter++}draw(e){const t=e.globalCompositeOperation;e.globalCompositeOperation="lighter";const n=this._counter;for(const t of this.particles)n>=t.startCounter&&n<=t.endCounter&&t.draw(e,n);e.globalCompositeOperation=t}};class o{constructor(e,t,n,i,s,a,o){this.startCounter=e,this.endCounter=t,this.startPos=n,this.endPos=i,this.startImgRotateRad=s,this.endImgRotateRad=a,this.imgScale=o}draw(e,t){const n=(t-this.startCounter)/(this.endCounter-this.startCounter),i=this.startPos.x*(1-n)+this.endPos.x*n,a=this.startPos.y*(1-n)+this.endPos.y*n,o=1-n,r=this.startImgRotateRad*(1-n)+this.endImgRotateRad*n,c=s.spriteInfos.explosion;s.spriteSheet.drawSprite(e,i-c.width/2,a-c.height/2,c,o,r,this.imgScale)}}},592:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VideoDisplayStyleSelector=void 0;const i=n(658),s=n(680),a=n(525),o=n(288);class r extends i.Component{constructor(){super(),this.element=$('<select class="video-style-selector">').append(a.videoDisplayStyleInfos.map((e=>$("<option>").prop("selected",e.style==s.faceMoonChallengeLocalStorage.videoDisplayStyle).text(e.name).val(e.style)))).on("change",(()=>{const e=this.element.val()+"";null!=a.videoDisplayStyleInfos.find((t=>t.style==e))&&(s.faceMoonChallengeLocalStorage.videoDisplayStyle=e,o.sceneController.faceStateTracker.videoDisplayStyle=e)}))}}t.VideoDisplayStyleSelector=r},593:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TimeoutTimer=void 0,t.TimeoutTimer=class{constructor(){}start(e){return new Promise((t=>{this.stop(),this.timerId=window.setTimeout((()=>{this.timerId=void 0,t()}),1e3*e)}))}stop(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=void 0)}}},603:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GameClearMenu=void 0;const i=n(393),s=n(658),a=n(742),o=n(288),r=n(984),c=n(493),l=["うまい！","こちら管制塔、着陸を確認！","静かの海に、無事降り立った…！","人類の新たな一歩だ！"];class h extends s.Component{constructor(){super(),this.element=$('<div class="game-clear-menu">').append($('<div class="stage">').text(`ステージ${a.gameState.stageInfo.title}`),$('<div class="title">').text("着陸成功"),$('<div class="message">').text(l[Math.floor(l.length*Math.random())]),new i.Button("もう一回遊ぶ",(()=>o.sceneController.changeScene(new c.GameScene))).element,new i.Button("ステージセレクト",(()=>o.sceneController.changeScene(new r.StageSelectScene))).element)}}t.GameClearMenu=h},611:function(e,t){var n=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.faceApi=void 0;const i=new faceapi.TinyFaceDetectorOptions({inputSize:160,scoreThreshold:.2});t.faceApi=new class{readWeights(){return n(this,void 0,void 0,(function*(){return Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri("./weights/"),faceapi.nets.faceLandmark68TinyNet.loadFromUri("./weights/")])}))}detectSingleFace(e){return n(this,void 0,void 0,(function*(){if(!(e instanceof HTMLVideoElement&&e.readyState<3))return faceapi.detectSingleFace(e,i).withFaceLandmarks(!0)}))}}},617:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Vec2=void 0;class n{constructor(e,t){this.x=e,this.y=t}scale(e){return new n(this.x*e,this.y*e)}}t.Vec2=n},622:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ValueRange=t.ParticleManager=void 0;const i=n(617),s=n(795);t.ParticleManager=class{constructor(){this.counter=0,this.particles=[]}generate(e,t,n){for(let o=0;o<e;o++){const e=n.lifeRange.rnd(),o=new i.Vec2((0,s.rndRange)(t.left,t.right),(0,s.rndRange)(t.top,t.bottom)),r=n.speedRange.rnd(),c=new i.Vec2(o.x+n.dir.x*e*r,o.y+n.dir.y*e*r);this.particles.push(new a(this.counter,this.counter+e,o,c,n.rgbRange.rnd()))}this.particles.length>500&&this.particles.splice(0,this.particles.length-500)}onSimulation(){this.counter++}draw(e){const t=e.globalCompositeOperation;e.globalCompositeOperation="lighter";for(let t=this.particles.length-1;t>=0;t--)this.particles[t].endCounter<=this.counter?this.particles.splice(t,1):this.particles[t].draw(e,this.counter);e.globalCompositeOperation=t}},t.ValueRange=class{constructor(e,t){this.v1=e,this.v2=t}rnd(){return(0,s.rndRange)(this.v1,this.v2)}};class a{constructor(e,t,n,i,s){this.startCounter=e,this.endCounter=t,this.startPos=n,this.endPos=i,this.color=s}draw(e,t){const n=(t-this.startCounter)/(this.endCounter-this.startCounter),i=this.startPos.x*(1-n)+this.endPos.x*n,s=this.startPos.y*(1-n)+this.endPos.y*n,a=1-.7*n;e.fillStyle=this.color+Math.floor(255*a).toString(16).padStart(0,"0"),e.fillRect(i,s,1,1)}}},658:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0,t.Component=class{constructor(){this.element=$()}}},679:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MutableVec2=void 0,t.MutableVec2=class{constructor(e,t){this.x=e,this.y=t}}},680:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.faceMoonChallengeLocalStorage=t.FaceMoonChallengeLocalStorage=void 0;const i=n(525),s="face-moon-challenge";class a{constructor(){this._clearStageIndex=-1,this._videoDisplayStyle="dark",this.load()}get clearStageIndex(){return this._clearStageIndex}set clearStageIndex(e){this._clearStageIndex!=e&&(this._clearStageIndex=e,this.save())}get videoDisplayStyle(){return this._videoDisplayStyle}set videoDisplayStyle(e){this._videoDisplayStyle=e,this.save()}load(){try{const e=localStorage.getItem(s);if(null==e)return;const t=JSON.parse(e);if(null==t)return;this._clearStageIndex=t.clearStageIndex,i.videoDisplayStyleInfos.find((e=>e.style==t.videoDisplayStyle))&&(this._videoDisplayStyle=t.videoDisplayStyle)}catch(e){console.error(e)}}save(){const e={clearStageIndex:this._clearStageIndex,videoDisplayStyle:this._videoDisplayStyle};try{localStorage.setItem(s,JSON.stringify(e))}catch(e){console.error(e)}}}t.FaceMoonChallengeLocalStorage=a,t.faceMoonChallengeLocalStorage=new a},742:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.gameState=void 0;const i=n(782);t.gameState=new class{constructor(){this.urlParams=new URL(location.href).searchParams,this.stageIndex=0}get stageInfo(){return i.stageInfos[this.stageIndex]}get isSoundTest(){return"1"==this.urlParams.get("soundTest")}get isResetData(){return"1"==this.urlParams.get("reset")}}},758:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Terrain=void 0;const i=n(917),s=n(3);t.Terrain=class{constructor(e){this.spriteRect=e,this.imageCollider=new s.ImageCollider(i.spriteSheet.getImageData(e))}draw(e){i.spriteSheet.drawSprite(e,0,0,this.spriteRect)}}},771:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.shortGainFade=void 0,t.shortGainFade=.001},782:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stageInfos=void 0;const i=n(287),s=n(617),a=n(917);t.stageInfos=[{title:"1. かんたん",terrainRect:a.spriteInfos.stage1Terrain,landingZone:new i.Rect(29,139,38,1),starshipPos:new s.Vec2((a.spriteInfos.stage1Terrain.width-a.spriteInfos.spaceship.width)/2,16),energy:15},{title:"2. 見習い",terrainRect:a.spriteInfos.stage2Terrain,landingZone:new i.Rect(50,140,38,1),starshipPos:new s.Vec2(32,16),energy:15},{title:"3. 一人前",terrainRect:a.spriteInfos.stage3Terrain,landingZone:new i.Rect(2,49,38,1),starshipPos:new s.Vec2(58,104),energy:15},{title:"4. ベテラン",terrainRect:a.spriteInfos.stage4Terrain,landingZone:new i.Rect(101,140,27,1),starshipPos:new s.Vec2(10,98),energy:15},{title:"5. 神フェイス",terrainRect:a.spriteInfos.stage5Terrain,landingZone:new i.Rect(115,84,27,1),starshipPos:new s.Vec2(68,23),energy:15}]},795:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.rndRange=function(e,t){const n=Math.random();return e*(1-n)+t*n}},890:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VirtualScreen=void 0;const i=n(658),s=n(287);class a extends i.Component{constructor(e){super(),this.size=e,this.element=$('<div class="screen">').css({width:e.x,height:e.y}),this._rect=new s.Rect(0,0,e.x,e.y)}get rect(){return this._rect}get scale(){return this._rect.width/this.size.x}layout(e){this._rect=e,this.element.css("transform",`translate(${e.x}px, ${e.y}px) scale(${this.scale})`)}}t.VirtualScreen=a},892:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.faceStateChecker=void 0;const s=n(611);function a(e,t){const n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}t.faceStateChecker=new class{isMouthOpen(e){const t=e.getMouth(),n=a(t[0],t[6]),i=a(t[18],t[14]);return 0!=i&&n/i<4}calcYaw(e){const t=e.getLeftEye(),n=e.getRightEye(),i=e.getNose(),s=n[3].x-t[0].x,a=n[3].y-t[0].y,o=Math.atan2(a,s),r=(t[0].x+n[3].x)/2,c=(t[0].y+n[3].y)/2;return((i[0].x-r)*Math.cos(o)+(i[0].y-c)*Math.sin(o))/s*100}getFaceState(e){return i(this,void 0,void 0,(function*(){const t=yield s.faceApi.detectSingleFace(e);if(null!=t)return{isMouthOpen:this.isMouthOpen(t.landmarks),yaw:this.calcYaw(t.landmarks)}}))}}},917:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.spriteSheet=t.spriteInfos=void 0;const s=n(287),a=n(998);t.spriteInfos={stage1Terrain:new s.Rect(2,2,96,156),stage2Terrain:new s.Rect(140,2,96,156),stage3Terrain:new s.Rect(239,2,96,156),stage4Terrain:new s.Rect(338,2,137,156),stage5Terrain:new s.Rect(478,2,144,156),spaceship:new s.Rect(101,2,17,16),explosion:new s.Rect(121,2,16,14),instruction1:new s.Rect(2,161,81,56),instruction2:new s.Rect(86,161,81,56)},t.spriteSheet=new class{constructor(){this.canvas=$("<canvas>")[0],this.ctx=this.canvas.getContext("2d")}load(){return i(this,void 0,void 0,(function*(){const e=new a.ImagePreloader("./spriteSheet.png?rev=0");yield e.load(),this.canvas.width=e.img[0].naturalWidth,this.canvas.height=e.img[0].naturalHeight,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(e.img[0],0,0)}))}getImageData(e){return this.ctx.getImageData(e.x,e.y,e.width,e.height)}drawSprite(e,t,n,i,s=1,a=0,o=1){if(1!=s&&(e.globalAlpha=s),0!=a||1!=o){const s=t+i.width/2,r=n+i.height/2,c=e.getTransform();e.translate(+s,+r),e.rotate(a),e.scale(o,o),e.translate(-s,-r),e.drawImage(this.canvas,i.x,i.y,i.width,i.height,t,n,i.width,i.height),e.setTransform(c)}else e.drawImage(this.canvas,i.x,i.y,i.width,i.height,t,n,i.width,i.height);1!=s&&(e.globalAlpha=1)}}},926:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AnimationFrameRequester=void 0,t.AnimationFrameRequester=class{constructor(){}request(e){this.cancel(),this.handle=window.requestAnimationFrame((t=>{this.handle=void 0,e(t)}))}cancel(){null!=this.handle&&(window.cancelAnimationFrame(this.handle),this.handle=void 0)}}},970:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LandingZone=void 0;const i=n(287);t.LandingZone=class{constructor(e){this.rect=e,this.phase=0,this.gradRect=i.Rect.fromLeftTopRightBottom(this.rect.left,this.rect.top-16,this.rect.right,this.rect.bottom)}onSimulation(){this.phase+=.005,this.phase%=1}draw(e){const t=this.gradRect,n=e.createLinearGradient(t.left,t.top,t.left,t.bottom);n.addColorStop(0,"rgba(0, 128, 0, 0)"),n.addColorStop(1,`rgba(0, 128, 0, ${.4*Math.abs(Math.sin(this.phase*Math.PI*2))+.1}) `),e.fillStyle=n,e.fillRect(t.left,t.top,t.width,t.height)}}},984:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StageSelectScene=void 0;const i=n(393),s=n(680),a=n(742),o=n(782),r=n(493),c=n(52),l=n(288),h=n(487);class u extends c.Scene{constructor(){super("stage-select-scene"),this.element.append($('<div class="title">').text("ステージセレクト"),o.stageInfos.map(((e,t)=>this.buildStateButton(e,t).element)),new i.Button("タイトルへ戻る",(()=>l.sceneController.changeScene(new h.TitleScene))).element.css("margin-top",48))}buildStateButton(e,t){const n=t<=s.faceMoonChallengeLocalStorage.clearStageIndex,o=t>=s.faceMoonChallengeLocalStorage.clearStageIndex+2,c=[];return n&&c.push("clear-badge"),o&&c.push("locked"),new i.Button(o?"":e.title,(()=>{a.gameState.stageIndex=t,l.sceneController.changeScene(new r.GameScene)}),c)}}t.StageSelectScene=u},998:function(e,t){var n=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,r)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ImagePreloader=void 0,t.ImagePreloader=class{constructor(e){this.url=e}load(){return new Promise(((e,t)=>n(this,void 0,void 0,(function*(){const i=()=>t(`${this.url}の読み込みに失敗しました。`);try{const t=document.createElement("img");t.onload=()=>{t.width=t.naturalWidth,t.height=t.naturalHeight,this._img=$(t),e()},t.onerror=()=>i(),t.src=yield function(e){return n(this,void 0,void 0,(function*(){const t=yield fetch(e);if(!t.ok)throw"error";const n=yield t.blob();return yield function(e){return new Promise(((t,n)=>{const i=new FileReader;i.onloadend=()=>t(i.result),i.readAsDataURL(e)}))}(n)}))}(this.url)}catch(e){i()}}))))}get img(){if(null==this._img)throw"画像読み込みエラー";return this._img}}}},t={};!function n(i){var s=t[i];if(void 0!==s)return s.exports;var a=t[i]={exports:{}};return e[i].call(a.exports,a,a.exports,n),a.exports}(156)})();